# ClassWaves Backend â€” Example Environment Variables

# === WebSocket Audio Backpressure (Per Socket) ===
# Upper bounds for per-socket audio traffic. Exceeding these causes soft drops
# with client-side hints to reduce send rate.
WS_MAX_AUDIO_EVENTS_PER_SEC=20
WS_MAX_AUDIO_BYTES_PER_SEC=1048576
WS_MAX_AUDIO_CHUNK_BYTES=2097152

# === Dev Observability ===
# Token used to gate /api/v1/debug/websocket/active-connections in production.
# In development (NODE_ENV !== 'production'), this endpoint is open.
DEV_OBSERVABILITY_TOKEN=

# Disable default Prometheus process metrics (useful in tests to avoid open handles)
# 1 = disable default prom-client metrics collection
METRICS_DEFAULT_DISABLED=0

# Note: This example only lists variables introduced by the WebSocket audio
# backpressure and dev observability work. Refer to README.md for the full
# environment template covering Databricks, Redis, JWT, OAuth, Whisper, etc.

# === Redis & Cache Defaults (enabled by default) ===
# Redis connection
REDIS_URL=redis://localhost:6379
# Optional password if your Redis requires auth
REDIS_PASSWORD=
# Connection sizing and timeouts
REDIS_POOL_SIZE=5
REDIS_TIMEOUT=3000

# Cache key prefixing (cw:{env}:...) [enabled by default; set to 0 to disable]
CW_CACHE_PREFIX_ENABLED=1
# During migration, dual-write to legacy keys (analytics/query caches) [enabled by default]
CW_CACHE_DUAL_WRITE=1
# Tag epochs for O(1) invalidation via versioned keys [enabled by default]
CW_CACHE_EPOCHS_ENABLED=1
# Cross-instance NX locks for hot key coalescing [enabled by default]
CW_CACHE_NX_LOCKS=1
# Compression threshold for large cached values (bytes)
CW_CACHE_COMPRESS_THRESHOLD=4096

# Rate limiter key prefix migration to cw:{env}:rl:* [enabled by default]
CW_RL_PREFIX_ENABLED=1

# === Feature Flags ===
# Enable end-of-session AI summaries (group + session)
FEATURE_GROUP_SESSION_SUMMARIES=0

# Optional: concurrency limit for parallel group summary generation
SUMMARY_GROUP_CONCURRENCY=4

# === Databricks AI Summarizer (E2E/live) ===
# Databricks workspace URL and PAT token must be set
DATABRICKS_HOST=https://dbc-d5db37cb-5441.cloud.databricks.com
# DATABRICKS_TOKEN=your-pat-token

# Use the summarizer serving endpoint for end-of-session summaries
AI_SUMMARIZER_ENDPOINT=/serving-endpoints/wavelistener-summarizer/invocations
# Payload mode: 'messages' (default) or 'input' depending on your serving endpoint contract
# AI_SUMMARIZER_PAYLOAD_MODE=messages
# Timeout in ms (defaults to tier2 timeout when unset)
# AI_SUMMARIZER_TIMEOUT_MS=15000

# If not using AI_SUMMARIZER_ENDPOINT, fall back to tier2
# AI_TIER2_ENDPOINT=/serving-endpoints/llm-t2/invocations
