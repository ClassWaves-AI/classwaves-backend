# ClassWaves Backend — Example Environment Variables (comprehensive)

# ——— Monitoring & Observability ———
HEALTH_CHECK_ENABLED=true
METRICS_COLLECTION_ENABLED=true
# Code checks HEALTH_ENABLE_ALERTS (not ALERTING_ENABLED)
HEALTH_ENABLE_ALERTS=true

# OpenTelemetry (disabled unless you set OTEL_ENABLED=1)
# OTEL_ENABLED=0
# OTEL_SERVICE_NAME=classwaves-backend
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# ——— Server ———
NODE_ENV=development
PORT=3000
CORS_ORIGIN=http://localhost:3001,http://localhost:3003

# ——— Authentication ———
JWT_SECRET=changeme-dev-only
JWT_EXPIRES_IN=7d
JWT_REFRESH_SECRET=changeme-dev-only
SESSION_ENCRYPTION_SECRET=changeme-dev-only

# ——— Google OAuth ———
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=http://localhost:3001/auth/callback

# ——— Email ———
EMAIL_FROM=ClassWaves <noreply@classwaves.com>
GMAIL_CLIENT_ID=
GMAIL_CLIENT_SECRET=
GMAIL_REFRESH_TOKEN=
GMAIL_USER_EMAIL=

# ——— URLs ———
STUDENT_APP_URL=http://localhost:3003

# ——— Redis & Cache ———
REDIS_URL=redis://localhost:6379
REDIS_POOL_SIZE=5
REDIS_TIMEOUT=3000
# Cache toggles (enabled by default)
CW_CACHE_PREFIX_ENABLED=1
CW_CACHE_DUAL_WRITE=1
CW_CACHE_EPOCHS_ENABLED=1
CW_CACHE_NX_LOCKS=1
CW_CACHE_COMPRESS_THRESHOLD=4096
CW_RL_PREFIX_ENABLED=1

# ——— Databricks ———
DATABRICKS_HOST=
DATABRICKS_WORKSPACE_URL=
DATABRICKS_TOKEN=
DATABRICKS_WAREHOUSE_ID=
# DATABRICKS_ENABLED=true  # Optional: force-enable DB usage outside tests

# ——— AI Analysis: Serving Endpoints ———
AI_TIER1_ENDPOINT=/serving-endpoints/tier1-group-analysis/invocations
AI_TIER2_ENDPOINT=/serving-endpoints/tier2-deep-analysis/invocations
AI_TIER1_TIMEOUT_MS=15000
AI_TIER2_TIMEOUT_MS=20000
AI_TIER1_WINDOW_SECONDS=45
AI_TIER2_WINDOW_MINUTES=2
AI_TIER1_MAX_TOKENS=1000
AI_TIER2_MAX_TOKENS=2000
AI_TIER1_TEMPERATURE=0.1
AI_TIER2_TEMPERATURE=0.1
AI_RETRY_MAX_ATTEMPTS=3
AI_RETRY_BACKOFF_MS=1000
AI_RETRY_JITTER=true

# Summarizer (optional)
AI_SUMMARIZER_ENDPOINT=/serving-endpoints/wavelistener-summarizer/invocations
AI_SUMMARIZER_PAYLOAD_MODE=messages  # or 'input'
# AI_SUMMARIZER_TIMEOUT_MS=20000

# ——— Guidance Gating & Delivery ———
GUIDANCE_TIER1_ONTRACK_THRESHOLD=0.50
# GUIDANCE_TIER1_RETURN_THRESHOLD=0.55
GUIDANCE_TIER1_CONF_MIN=0.50
GUIDANCE_TIER1_WARMUP_MS=60000
GUIDANCE_TIER1_FIRST_WINDOW_SECONDS=60
GUIDANCE_TIER1_SUPPRESS_ONTRACK=1

# Tier2 delivery
GUIDANCE_TIER2_PASSIVE=1          # 1 = compute/persist only; set 0 to emit
GUIDANCE_TIER2_PER_GROUP=1        # enable per-group Tier2

# Per-group Tier2 thresholds and guardrails
AI_TIER2_GROUP_WINDOW_MINUTES=4
AI_TIER2_GROUP_MIN_TRANSCRIPTS=6
AI_TIER2_GROUP_MIN_CHARS=400
AI_TIER2_GROUP_MAX_CONCURRENCY=2

# ——— AI Processing & Buffering ———
AI_TIER1_PROCESSING_INTERVAL_MS=30000
AI_TIER2_PROCESSING_INTERVAL_MS=180000
AI_MAX_CONCURRENT_ANALYSES=10
AI_GRACEFUL_DEGRADATION=true
AI_HEALTH_CHECK_INTERVAL_MS=60000

AI_BUFFER_MAX_SIZE=50
AI_BUFFER_MAX_AGE_MS=60000
AI_TIER1_WINDOW_MS=30000
AI_TIER2_WINDOW_MS=180000
AI_BUFFER_CLEANUP_INTERVAL_MS=30000

# ——— Teacher Guidance ———
TEACHER_GUIDANCE_ENABLED=true
TEACHER_PROMPT_MAX_PER_SESSION=15
TEACHER_PROMPT_EXPIRATION_MINUTES=30
TEACHER_PROMPT_EFFECTIVENESS_WEIGHT=0.3
TEACHER_PROMPT_SUBJECT_AWARE=true
TEACHER_PROMPT_BATCH_INTERVAL_MS=30000

TEACHER_ALERT_REAL_TIME=true
TEACHER_ALERT_HIGH_PRIORITY_SOUND=false
TEACHER_ALERT_MAX_PER_MINUTE=5
TEACHER_ALERT_HIGH_PRIORITY_THRESHOLD=0.7
TEACHER_ALERT_ADAPTIVE_LEARNING=true
TEACHER_ALERT_AUTO_EXPIRE_MS=120000

# ——— STT (OpenAI Whisper) ———
OPENAI_API_KEY=
OPENAI_WHISPER_TIMEOUT_MS=60000
OPENAI_WHISPER_CONCURRENCY=20
OPENAI_WHISPER_PER_SCHOOL_CONCURRENCY=5
OPENAI_WHISPER_HEALTH_ENABLED=0
STT_WINDOW_SECONDS=20
STT_INLINE_WORKER=1
STT_WINDOW_JITTER_MS=0
STT_PROVIDER=openai
STT_BUDGET_MINUTES_PER_DAY=0
STT_BUDGET_ALERT_PCTS=50,75,90,100
STT_FORCE_MOCK=0
STT_TRANSCODE_TO_WAV=1
FFMPEG_PATH=ffmpeg
WS_STT_REPAIR_WEBM_FRAGMENTS=1
WS_STT_TRANSCODE_TO_WAV=1
WS_AUDIO_FLUSH_CADENCE_MS=10000
WS_STALL_CHECK_INTERVAL_MS=10000
WS_STALL_NOTIFY_COOLDOWN_MS=30000
STT_LANGUAGE_HINT=en

# ——— REST Guardrails ———
AUDIO_WINDOW_MIN_INTERVAL_MS=800

# ——— E2E / Dev Utilities ———
E2E_TEST_SECRET=test-secret-key
API_DEBUG=1
ANALYTICS_USE_PLANNED_VS_ACTUAL=0
WS_ORDERED_EMITS=1

# ——— Timeouts & Circuit Breakers ———
CIRCUIT_BREAKER_ENABLED=true
GOOGLE_OAUTH_TIMEOUT=5000
DATABASE_TIMEOUT=10000
REDIS_TIMEOUT=3000

# ——— Feature Flags ———
FEATURE_GROUP_SESSION_SUMMARIES=0
SUMMARY_GROUP_CONCURRENCY=4

# ——— Databricks SQL Admin Scripts ———
# Optional token for health audit scripts
# API_AUDIT_TOKEN=

# ——— SLI TTLs ———
# SLI_SESSION_TTL_SECONDS=3600

# ——— WebSocket Audio Backpressure (Per Socket) ———
WS_MAX_AUDIO_EVENTS_PER_SEC=20
WS_MAX_AUDIO_BYTES_PER_SEC=1048576
WS_MAX_AUDIO_CHUNK_BYTES=2097152

# ——— Dev Observability ———
DEV_OBSERVABILITY_TOKEN=
METRICS_DEFAULT_DISABLED=0
