 What’s correct and working

  - OPENAI_API_KEY is the correct key name for the backend. The Whisper
  validator script you ran showed HTTP 200, so the key is loading and
  usable by Node.
  - OPENAI_WHISPER_TIMEOUT_MS=60000 is a good real‑world timeout.
  - STT_INLINE_WORKER=1 is good for dev; it runs the BullMQ worker inline
  with the server so jobs are consumed.
  - OPENAI_WHISPER_HEALTH_ENABLED=0 is correct if you want to avoid
  outbound Whisper health probes on each /health call in dev.
  - STT_TRANSCODE_TO_WAV=1 is OK (helps only if we later add true
  transcode).

  Problems I see and the proper fixes

  - A bad line that will be ignored or cause confusion:
      - redisPassword = ''; ← Remove this line entirely. It’s not a
  valid .env key (case + spaces + semicolon).
  - Duplicates and contradictions:
      - REDIS_URL appears twice. Keep only one: REDIS_URL=redis://
  localhost:6379
      - ENABLE_DB_METRICS_PERSIST appears twice. Keep only one (set to 0).
  - Unused or misleading envs:
      - CORS_ORIGIN is not used by the backend. In production the
  backend uses CORS_WHITELIST, and in development the CORS dev whitelist
  is hardcoded. If you want to control prod CORS from env, rename to
  CORS_WHITELIST and set comma-separated origins.
      - DATABRICKS_WAVEWHISPERER_URL is a legacy variable we no longer use
  for STT (we moved to OpenAI Whisper). It can be removed.
      - HEALTH_CHECK_ENABLED, METRICS_COLLECTION_ENABLED, ALERTING_ENABLED:
  these names are not read anywhere in the backend code right now. If you
  don’t use them elsewhere, they can be removed without effect.
      - STT_WINDOW_SECONDS, STT_PROVIDER, STT_WINDOW_JITTER_MS were used by
  the old WS streaming path, not by the current HTTP 10s window pipeline.
  They don’t break anything, but they don’t control the current flow.
  - Optional but recommended:
      - Add STT_QUEUE_CONCURRENCY=10 to control worker concurrency
  explicitly (dev can keep 10; you’ll tune in prod).
      - If you’re using the periodic transcript flush in the API process,
  add TRANSCRIPT_BATCH_FLUSH_SECS=120 (or keep the default). In prod, you
  may run a separate flusher process instead.



-----------------------------------
Proper 
# Core

  NODE_ENV=development
  PORT=3000

  # Redis

  REDIS_URL=redis://localhost:6379
  REDIS_PASSWORD=

  # OpenAI Whisper

  OPENAI_API_KEY=YOUR_REAL_KEY
  OPENAI_WHISPER_TIMEOUT_MS=60000
  OPENAI_WHISPER_CONCURRENCY=20
  OPENAI_WHISPER_PER_SCHOOL_CONCURRENCY=5
  OPENAI_WHISPER_HEALTH_ENABLED=0

  # STT Worker

  STT_INLINE_WORKER=1
  STT_QUEUE_CONCURRENCY=10
  STT_TRANSCODE_TO_WAV=1
  STT_FORCE_MOCK=0

  # Transcripts

  TRANSCRIPT_REDIS_TTL_HOURS=12
  TRANSCRIPT_BATCH_FLUSH_SECS=120

  # Databricks (leave empty if not needed in dev)

  DATABRICKS_HOST=
  DATABRICKS_TOKEN=
  DATABRICKS_WAREHOUSE_ID=
  DATABRICKS_CATALOG=classwaves
  ENABLE_DB_METRICS_PERSIST=0

  # OAuth/Email (only if used locally)

  GOOGLE_CLIENT_ID=
  GOOGLE_CLIENT_SECRET=
  GOOGLE_REDIRECT_URI=
  EMAIL_FROM=ClassWaves noreply@classwaves.com (noreply@classwaves.com)
  GMAIL_CLIENT_ID=
  GMAIL_CLIENT_SECRET=
  GMAIL_REFRESH_TOKEN=
  GMAIL_USER_EMAIL=
  STUDENT_APP_URL=http://localhost:3003

  # CORS (prod only)

  # CORS_WHITELIST=https://app.classwaves.com,https://
  student.classwaves.com

  # E2E/Dev helpers

  E2E_TEST_SECRET=test-secret-key
  REDIS_TIMEOUT=3000








-------------------------------------

OLD BELOW

# Monitoring Configuration
HEALTH_CHECK_ENABLED=true
METRICS_COLLECTION_ENABLED=true
ALERTING_ENABLED=true

# Databricks Configuration
DATABRICKS_HOST=
DATABRICKS_TOKEN=
DATABRICKS_WAREHOUSE_ID=
ENABLE_DB_METRICS_PERSIST=0

# Google OAuth Configuration
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=


# Email Configuration
EMAIL_FROM=ClassWaves <noreply@classwaves.com>
GMAIL_CLIENT_ID=30672326240-c5sc0cggor2dkenuc0m9lv3td9m6nvo9.apps.googleusercontent.com
GMAIL_CLIENT_SECRET=
GMAIL_REFRESH_TOKEN=
GMAIL_USER_EMAIL=rob@classwaves.ai
STUDENT_APP_URL=http://localhost:3003

# JWT Configuration
JWT_SECRET=classwaves-jwt-secret-key-2024
JWT_EXPIRES_IN=7d
# Enhanced JWT Security
JWT_REFRESH_SECRET=
SESSION_ENCRYPTION_SECRET=

# Redis Configuration
REDIS_URL=redis://localhost:6379
redisPassword = '';
# Redis Optimization
REDIS_POOL_SIZE=5
REDIS_URL=redis://localhost:6379
REDIS_PASSWORD=

# OpenAI Configuration
OPENAI_API_KEY=

# Application Configuration
NODE_ENV=development
PORT=3000
DATABRICKS_WAVEWHISPERER_URL="https://dbc-d5db37cb-5441.cloud.databricks.com/serving-endpoints/waveWhisperer/invocations"

# AI Analysis Configuration - Databricks Serving Endpoints
AI_TIER1_ENDPOINT=/serving-endpoints/tier1-group-analysis/invocations
AI_TIER2_ENDPOINT=/serving-endpoints/tier2-deep-analysis/invocations
AI_TIER1_TIMEOUT_MS=15000
AI_TIER2_TIMEOUT_MS=20000
AI_TIER1_WINDOW_SECONDS=30
AI_TIER2_WINDOW_MINUTES=3
AI_TIER1_MAX_TOKENS=1000
AI_TIER2_MAX_TOKENS=2000
AI_TIER1_TEMPERATURE=0.1
AI_TIER2_TEMPERATURE=0.1
AI_RETRY_MAX_ATTEMPTS=3
AI_RETRY_BACKOFF_MS=1000
AI_RETRY_JITTER=true
FEATURE_GROUP_SESSION_SUMMARIES=1
AI_SUMMARIZER_ENDPOINT=/serving-endpoints/wavelistener-summarizer/invocations
AI_SUMMARIZER_PAYLOAD_MODE=messages # set to 'input' if your serving endpoint expects a single input field


# AI Processing Configuration
AI_TIER1_PROCESSING_INTERVAL_MS=30000
AI_TIER2_PROCESSING_INTERVAL_MS=180000
AI_MAX_CONCURRENT_ANALYSES=10
AI_GRACEFUL_DEGRADATION=true
AI_HEALTH_CHECK_INTERVAL_MS=60000

# AI Buffer Configuration
AI_BUFFER_MAX_SIZE=50
AI_BUFFER_MAX_AGE_MS=60000
AI_TIER1_WINDOW_MS=30000
AI_TIER2_WINDOW_MS=180000
AI_BUFFER_CLEANUP_INTERVAL_MS=30000

# Teacher Guidance Configuration
TEACHER_GUIDANCE_ENABLED=true
TEACHER_PROMPT_MAX_PER_SESSION=15
TEACHER_PROMPT_EXPIRATION_MINUTES=30
TEACHER_PROMPT_EFFECTIVENESS_WEIGHT=0.3
TEACHER_PROMPT_SUBJECT_AWARE=true
TEACHER_PROMPT_BATCH_INTERVAL_MS=30000

# Teacher Alert Configuration
TEACHER_ALERT_REAL_TIME=true
TEACHER_ALERT_HIGH_PRIORITY_SOUND=true
TEACHER_ALERT_MAX_PER_MINUTE=5
TEACHER_ALERT_HIGH_PRIORITY_THRESHOLD=0.7
TEACHER_ALERT_ADAPTIVE_LEARNING=true
TEACHER_ALERT_AUTO_EXPIRE_MS=120000

# OpenAI Whisper Configuration (already exists, but ensuring completeness)
OPENAI_WHISPER_TIMEOUT_MS=60000
OPENAI_WHISPER_CONCURRENCY=20
OPENAI_WHISPER_PER_SCHOOL_CONCURRENCY=5
OPENAI_WHISPER_HEALTH_ENABLED=0
STT_WINDOW_SECONDS=15
STT_INLINE_WORKER=1
STT_WINDOW_JITTER_MS=0
STT_PROVIDER=openai
STT_BUDGET_MINUTES_PER_DAY=0
STT_BUDGET_ALERT_PCTS=50,75,90,100
STT_FORCE_MOCK=0
STT_TRANSCODE_TO_WAV=1
ENABLE_DB_METRICS_PERSIST=0

# E2E Testing Configuration
E2E_TEST_SECRET=test-secret-key
DATABRICKS_WORKSPACE_URL=https://dbc-d5db37cb-5441.cloud.databricks.com


# Circuit Breaker Configuration
CIRCUIT_BREAKER_ENABLED=true
GOOGLE_OAUTH_TIMEOUT=5000
DATABASE_TIMEOUT=10000
REDIS_TIMEOUT=3000
CORS_ORIGIN=http://localhost:3001,http://localhost:3003
